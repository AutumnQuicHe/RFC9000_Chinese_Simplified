---
title: "5.2.2 服务端数据包处理"
anchor: "5.2.2_Server_Packet_Handling"
weight: 522
rank: "h3"
---

如果服务端收到一个来自不支持版本的数据包而其又足够初始化某个支持版本的新连接，服务端{{< req_level SHOULD >}}发送一个版本协商包，详见[第6.1章]()。
服务端{{< req_level MAY >}}限制其回复的版本协商包的数量。
服务端{{< req_level MUST >}}丢弃属于不支持版本的小包。

一个不支持版本的第一个包可以对任何与具体版本有关的字段使用不同语义和编码。
尤其是不同的版本可能使用不同的数据包保护密钥。
不支持一个特定版本的服务端不太可能解密数据包的有效负载或正确解释其内容。
当数据报文足够长时，服务端{{< req_level SHOULD >}}回复一个版本协商包。

有一个支持版本或没有版本字段的数据包通过连接ID或——对于零长度连接ID的数据包——本地地址和端口与一个连接匹配，这些包在该连接上处理；否则，服务端继续做如下处理。

如果数据包是完全符合规范的初始化包，则服务端继续进行握手（[第7章]()）。
服务端会指派为客户端选择的版本。

如果服务端拒绝接收一个新连接，它{{< req_level SHOULD >}}发送一个带`连接关闭帧`的初始化包给客户端，其中`连接关闭帧`的错误码设置为`CONNECTION_REFUSED`（连接拒绝）。

如果数据包是一个0-RTT包，服务端{{< req_level MAY >}}进行有限数量的缓存，因为后续预期会收到初始化包。
由于客户端不可能先于收到服务端回复发送握手包，所以服务端{{< req_level SHOULD >}}忽略任何这样的包。

服务端{{< req_level MUST >}}丢弃任何其他场合收到的数据包。
