---
title: "10.2 立即关闭"
anchor: "10.2_Immediate_Close"
weight: 1020
rank: "h2"
---

终端发送**连接关闭帧**（详见[第19.19章](#19.19_CONNECTION_CLOSE_Frames)）来立即终止连接。**连接关闭帧**使得所有流都被立即关闭；开放的流可以被假定为被隐式重置。

在发送**连接关闭帧**之后，终端立即进入关闭状态，详见[第10.2.1章](#10.2.1_Closing_Connection_State)。在收到**连接关闭帧**之后，终端进入排空状态，详见[第10.2.2章](#10.2.2_Draining_Connection_State)。

对协议的违背将引发立即关闭。

在应用协议计划关闭一条连接后，可以使用立即关闭。这时可能是应用协议协商了一次正常关闭。应用协议可以交换用于两侧应用终端协商关闭连接的消息，在那之后请求QUIC关闭连接。当QUIC因此关闭连接后，带着由应用提供的错误码的**连接关闭帧**会被用于向对端发送关闭的信号。

关闭和排空状态用于确保连接被干净地关闭，以及延误的和乱序的数据包被正确地丢弃。这些状态的持续时间{{< req_level SHOULD >}}至少为当前PTO间隔（定义于《[QUIC恢复](../RFC9002_Chinese_Translation)》）的三倍大小。

在退出关闭或排空状态前就处理连接的状态数据，可能导致终端在收到被延误的数据包时不必要地发起无状态重置。有一些备用手段来确保被延误的数据包不会引起响应的终端，比如那些有能力关闭UDP套接字的终端，{{< req_level MAY >}}更早地结束连接的状态以更快地恢复可用资源。始终保持一个套接字开放以接受新连接的服务器{{< req_level SHOULD_NOT >}}过早结束关闭或排空状态。

一旦终端的关闭或排空状态结束，它就{{< req_level SHOULD >}}丢弃所有连接状态数据。终端在响应任何将来的属于这条连接的传入数据包时，{{< req_level MAY >}}发送无状态重置。
