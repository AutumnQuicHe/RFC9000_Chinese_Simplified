---
title: "10.2.1 连接的关闭状态"
anchor: "10.2.1_Closing_Connection_State"
weight: 1021
rank: "h3"
---

终端发起立即关闭后进入关闭状态。

在关闭状态下，终端仅保留足够用于创建包含**连接关闭帧**的数据包和用于区分数据包是否属于此条已关闭连接的信息。处于关闭状态的终端发送包含**连接关闭帧**的数据包来响应任何属于这条连接的传入数据包。

终端{{< req_level SHOULD >}}限制它在关闭状态下创建数据包的速率。比如，终端可以在响应接收到的数据包前等待足够的数据包或时间，且等待的数据包数量或时间长短是逐渐增长的。

终端选择的连接ID和QUIC版本是区分数据包是否属于一条关闭状态的连接的充分信息；终端{{< req_level MAY >}}丢弃所有其他连接状态数据。处于关闭状态的终端没有必要处理任何接收到的帧。终端{{< req_level MAY >}}为传入数据包保留数据包保护密钥用于读取和处理**连接关闭帧**。

当进入关闭状态时，终端{{< req_level MAY >}}丢弃数据包保护密钥，然后在响应任何接收到的UDP数据报时都发送包含**连接关闭帧**的数据包。然而，丢弃了数据包保护密钥的终端没有能力区分并丢弃不合法的数据包。为了避免被用于放大攻击，这样的终端{{< req_level MUST >}}限制它发出的数据包尺寸总和不超过它接收到的且属于这条连接的数据包尺寸总和的三倍。为了最小化终端为关闭状态的连接所维护的状态数据，终端{{< req_level MAY >}}在响应任何接收到的数据包时发送完全相同的数据包。

> 注意：允许在关闭状态下重传完全相同的数据包是“每个数据包都必须使用新的数据包号”要求的一个特例，详见[第12.3章](#12.3_Packet_Numbers)。发送新的数据包号主要是用于丢包恢复和拥塞控制，但这两者都和一个已关闭的连接关系不大。重传这最后一个数据包需要的状态数据更少。

当处于关闭状态时，终端可能从新的源地址接收到数据包，这可能是连接迁移的结果；详见[第9章](#9_Connection_Migration)。处于关闭状态的终端{{< req_level MUST >}}要么丢弃从未经验证的地址接收到的数据包，要么限制它发向未经验证的地址的数据包尺寸总和，使其小于它从那个地址接收到的数据包的尺寸总和。

处于关闭状态的终端不应处理密钥更新（详见《[QUIC-TLS](../RFC9001_Chinese_Translation)》的[第6章](../RFC9001_Chinese_Translation/#6_Key_Update)）。密钥更新可能阻止终端从关闭状态转移到排空状态，因为终端将失去处理后续接收到的数据包的能力，但这没有什么影响。
