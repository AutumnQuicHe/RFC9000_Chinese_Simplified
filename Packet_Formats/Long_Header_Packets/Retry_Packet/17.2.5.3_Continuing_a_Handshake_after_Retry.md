---
title: "17.2.5.3 重试后继续握手"
anchor: "17.2.5.3_Continuing_a_Handshake_after_Retry"
weight: 1725.3
rank: "h4"
---

后续来自客户端的初始数据包包含着来自重试数据包的连接ID和令牌值。客户端从重试数据包中拷贝源连接ID字段至目标连接ID字段并且持续使用它，直到接收到一个包含着更新过的值的初始数据包，详见[第7.2章]()。令牌字段的值被拷贝至所有后续初始数据包，详见[第8.1.2章]()。

除了要更新目标连接ID和令牌字段外，客户端后续发出的初始数据包与首个初始数据包受到同样的限制。客户端{{< req_level MUST >}}使用和首个初始数据包中相同的加密握手消息。对于包含了不同加密握手消息的数据包，服务器{{< req_level MAY >}}将其视作为一种连接错误，或丢弃它。注意，包含令牌字段会减少数据包中加密握手消息的可用空间，这可能导致客户端需要发送多个初始数据包。

客户端{{< req_level MAY >}}在接收到重试数据包后尝试0-RTT，方法是向服务器提供的连接ID发送0-RTT数据包。

客户端{{< req_level MUST_NOT >}}在处理完重试数据包后重置任何数据包号空间中的数据包号。尤其是，0-RTT数据包包含着的机密信息很有可能在接收到重试数据包时被重新传输。由于是在回复一个重试数据包，用于保护这些新0-RTT数据包的密钥不会改变。然而，这些数据包中发送的数据可能和之前发送的不一样。用相同的数据包号发送这些新数据包可能使这些数据包的数据包保护失效，因为相同的密钥和随机数可能被用于保护不同内容。服务器如果检测到客户端重置了数据包号。它{{< req_level MAY >}}中止这次连接。

在客户端和服务器间被交换的初始数据包和重试数据包中的那些连接ID会被拷贝到传输参数中并且被验证，详见[第7.3章]()。
