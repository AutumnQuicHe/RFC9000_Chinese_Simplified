---
title: "7.5. 加密信息缓存"
anchor: "7.5_Cryptographic_Message_Buffering"
weight: 750
rank: "h2"
---

QUIC实现需要维护一个用于保存乱序接收到的加密数据的缓存区。
由于**加密帧**没有流量控制，终端有可能强制对端缓存无限量的数据。

QUIC实现{{< req_level MUST >}}支持缓存至少4096字节从乱序**加密帧**收到的数据。
终端{{< req_level MAY >}}选择允许在握手期间缓存更多的数据。
更大的缓存上限意味着可以交换更大的密钥或证书。
终端的缓存区大小不必在整个连接生命周期内保持不变。

握手期间无法缓存**加密帧**可能导致连接失败。
如果终端的缓存区在握手期间溢出，则其可以通过暂时扩大缓存空间确保握手完成。
如果终端不扩大其缓存，则其{{< req_level MUST >}}以错误码`CRYPTO_BUFFER_EXCEEDED`关闭连接。

Once the handshake completes, if an endpoint is unable to buffer all data in a CRYPTO frame, it MAY discard that CRYPTO frame and all CRYPTO frames received in the future, or it MAY close the connection with a CRYPTO_BUFFER_EXCEEDED error code. Packets containing discarded CRYPTO frames MUST be acknowledged because the packet has been received and processed by the transport even though the CRYPTO frame was discarded.

一旦握手完成，如果终端不能缓存**加密帧**中的全部数据，那么其{{< req_level MAY >}}丢弃该帧及其随后收到的所有**加密帧**，也{{< req_level MAY >}}以错误码`CRYPTO_BUFFER_EXCEEDED`关闭连接。
{{< req_level MUST >}}确认包含被丢弃的**加密帧**的数据包，因为该数据包已经被接收且被传输层处理了，即使是以丢弃**加密帧**的方式处理的。
