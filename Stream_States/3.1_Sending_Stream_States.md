---
title: "3.1. 流发送状态"
anchor: "3.1_Sending_Stream_States"
weight: 310
rank: "h2"
---

[图2](#Figure_2_States_for_Sending_Parts_of_Streams)展示了通过流向对端发送发送数据的状态。

{{< block_img
    indx="Figure_2_States_for_Sending_Parts_of_Streams"
    title="图2：流数据发送部分状态"
    type="svg"
    src="/RFC9000_Chinese_Translation/images/Figure_2_States_for_Sending_Parts_of_Streams.svg" >}}

终端发起的流的发送部分（客户端发起的流类型是0和2，1和3则是由服务端发起的）由应用层打开。
用于发送的流数据可能被缓存起来。

发送首个**流帧**（STREAM）或**流阻塞帧**（STREAM_DATA_BLOCKED）使流的发送部分进入“发送”状态。
QUIC实现可以选择延迟分配流ID直到其发送首个**流帧**并进入“发送”状态，这样可以实现更好的流优先级。

由对端发起的双向流的发送部分（服务端发起的流类型是0，客户端发起的是1）在接收部分创建时就已处于“就绪”状态，并从此状态开始。

在“发送”状态，终端通过**流帧**传输——必要时重传——流数据。
终端遵从其对端设置的流量控制限制，同时持续接收与处理**最大流数据帧**（MAX_STREAM_DATA）。
当发送过程被流的流量控制限制（[第4.1章](#4.1_Data_Flow_Control)）所阻塞时，处在“发送”状态的终端会生成**流阻塞帧**。

在应用层表示所有应用数据及一个带FIN置位的**流帧**都发送完成后，流的发送部分进入“发送完成”状态。
从这个状态开始，终端只会做必要的数据重传。
在对端收到最终流下标前，都有可能收到**最大流数据帧**。
处于此状态的终端可以忽略任何其收到的**最大流数据帧**，这样是安全的。

当所有流数据都被成功确认后，发送部分进入“接收完成”状态，这是一个最终状态。

处在“就绪”、“发送”及“发送完成”状态中的任何一个状态时，应用层都可以提出取消发送流数据。
相应地，终端也可能从其对端收到一个**停止发送帧**（STOP_SENDING）。
不论哪种情况，终端都会发送**流重置帧**（RESET_STREAM），随后流进入“重置发送”状态。

终端{{< req_level MAY >}}发送一个**流重置帧**作为流的首个帧，这会导致该流的发送部分开启然后立即转到“重置发送”状态。

一旦一个包含**流重置帧**的数据包被确认，流的发送部分即进入“重置接收”状态，这也是一个最终状态。