---
title: "8.1.4 地址验证令牌完整性"
anchor: "8.1.4_Address_Validation_Token_Integrity"
weight: 814
rank: "h3"
---

地址验证令牌{{< req_level MUST >}}是难以猜测的。在令牌中包含一个有着至少128位的熵的随机值会是足够的，但是这需要服务器记录它发送给客户端的值。

基于令牌的方案允许服务器将关于验证的状态数据带来的负载转移到客户端上。要使这种设计正常工作，令牌{{< req_level MUST >}}被能够抵御客户端修改或伪造的完整性保护所覆盖。要是没有完整性保护，恶意的客户端就能生成或猜测会被服务器接收的令牌值。只有服务器需要访问令牌的完整性保护密钥。

对令牌制定单一的定义良好的格式是没有必要的，因为服务器即使生成者又是消费者。在重试数据包中发送的令牌{{< req_level SHOULD >}}包含允许服务器验证客户端数据包中的源IP地址和端口是否保持不变的信息。

在**新令牌帧**中发送的令牌{{< req_level MUST >}}包含允许服务器验证客户端的IP地址是否和令牌签发时的值一致的信息。服务器可以使用来自**新令牌帧**的令牌来做出不发送重试数据包的决定，即使客户端地址已经改变。如果客户端的IP地址已经改变，那么服务器{{< req_level MUST >}}遵守抗放大上限；详见[第8章]()。注意，由于NAT的存在，这项要求可能不足以保护其他共享NAT的主机免于放大攻击。

攻击者可能在DDoS攻击中重放令牌来将服务器用作放大器。为了抵御这种攻击，服务器{{< req_level MUST >}}确保令牌的重放是被阻止或限制的。服务器{{< req_level SHOULD >}}确保在重试数据包中发送的令牌仅会在一段较短时间内被接受，因为它们会被客户端立即返回。在**新令牌帧**（详见[第19.7章]()）中提供的令牌应该有更长的有效时间但是{{< req_level SHOULD_NOT >}}能被多次接受。建议服务器尽可能只允许令牌被使用一次；令牌{{< req_level MAY >}}包含关于客户端的额外信息来进一步缩减适用范围或重用机会。
