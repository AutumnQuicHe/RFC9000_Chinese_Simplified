---
title: "9.6.3 客户端迁移与首选地址的交互"
anchor: "9.6.3_Interaction_of_Client_Migration_and_Preferred_Address"
weight: 963
rank: "h3"
---

客户端可能想要在迁移到服务器的首选地址前先进行一次连接迁移。在这种情况下，客户端{{< req_level SHOULD >}}从它的新地址同时对原始的和首选的服务器地址进行路径验证。

如果对服务器首选地址的路径验证通过了，那么客户端{{< req_level MUST >}}放弃对原始地址的验证并且迁移至服务器的首选地址。如果对服务器首先地址的路径验证失败了但是对服务器原始地址的的验证成功了，那么客户端{{< req_level MAY >}}迁移到它的新地址，并且继续向服务器的原始地址发送数据。

如果在服务器的首选地址接收到的数据包有着与在握手期间观测到的值不同的客户端源地址，那么服务器{{< req_level MUST >}}如[第9.3.1章](#9.3.1_Peer_Address_Spoofing)和[第9.3.2章](#9.3.2_On-Path_Address_Spoofing)描述的那样保护自己免受潜在的攻击。除了有意的同时迁移，这种情况还会因为客户端的网络在访问服务器首选地址时使用了不同的NAT绑定而发生。

服务器{{< req_level SHOULD >}}在接收到来自不同地址的探测数据包时向客户端的新地址发起路径验证，详见[第8章](#8_Address_Validation)。

迁移到新地址的客户端{{< req_level SHOULD >}}使用与服务器正使用的地址族一致的首选地址。

由传输参数`preferred_address`提供的连接ID不是特定于参数中提供的地址的。提供这个连接ID是为了客户端有一个可以用来迁移的连接ID，但客户端{{< req_level MAY >}}在任何路径上使用这个连接ID。
