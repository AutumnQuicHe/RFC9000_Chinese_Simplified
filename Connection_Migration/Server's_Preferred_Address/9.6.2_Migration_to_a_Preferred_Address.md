---
title: "9.6.2 迁移至首选地址"
anchor: "9.6.2_Migration_to_a_Preferred_Address"
weight: 962
rank: "h3"
---

迁移至首选地址的客户端{{< req_level MUST >}}在迁移前验证它选择的地址，详见[第21.5.3章](#21.5.3_Request_Forgery_with_Preferred_Addresses)。

服务器可能在接受一条连接后的任何时间接收到一个发到它的首选IP地址的数据包。如果这个数据包包含了**通道挑战帧**，那么服务器就要像[第8.2章](#8.2_Path_Validation)所描述的那样发送**回复通道帧**。服务器{{< req_level MUST >}}保持从它的原始地址发送非探测数据包，直到它在首选地址上接收到了来自客户端的非探测数据包并且它对新路径完成了验证。

服务器{{< req_level MUST >}}从它的首选地址探测通向客户端的路径。这有助于抵御由攻击者发起的虚假迁移。

一旦服务器完成了路径验证并且在首选地址上收到了具有新的最大数据包号的非探测数据包，它就开始仅仅从首选IP地址向客户端发送非探测数据包。如果服务器在旧IP地址上接收到了属于这条连接的更加新的数据包，那么服务器{{< req_level SHOULD >}}丢弃它们。服务器{{< req_level MAY >}}继续处理在旧IP地址上接收到的被延误的数据包。

服务器在传输参数`preferred_address`中提供的地址仅对提供地址时所处的连接有效。客户端{{< req_level MUST_NOT >}}将它们用于其他连接，包括从当前连接恢复的连接。
