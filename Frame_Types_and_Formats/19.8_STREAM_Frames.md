---
title: "19.8 流帧"
anchor: "19.8_STREAM_Frames"
weight: 190800
rank: "h2"
---

**流帧**明确地创建一条流并携带流数据。
**流帧**的类型字段格式形如`0b00001XXX`（即从`0x08`到`0x0f`之间的值）。
帧类型的三个低比特位标示帧的如下字段：

- 帧类型中的`OFF`位（`0x04`）用于标识帧的偏移字段。
  当置为1，则表示偏移字段存在。
  当置为0，则偏移字段不存在，且流数据的偏移量从0另开（也就是说，该帧携带这条流的起始字节，或该流的终点且不携带任何数据）。
- 帧类型的`LEN`位（`0x02`）用于标识帧的长度字段。
  当置为1，则表示长度字段不存在，且流数据字段延续到数据包的末尾。
  当置为1，则表示长度字段存在。
- 帧类型的`FIN`位（`0x01`）标志流的结束。
  流的最终数据量等于偏移量与该帧的长度之和。

如果收到属于一条由本地初始化却尚未创建的流或一条只用于发送的流的**流帧**，则终端{{< req_level MUST >}}以`STREAM_STATE_ERROR`类型错误关闭连接。

**流帧**格式如[图32](#Figure_32_STREAM_Frame_Format)所示。

{{% block_ref
    indx="Figure_32_STREAM_Frame_Format"
    title="图32：流帧格式" %}}

```
流帧 {
  类型 (i) = 0x08..0x0f,
  流ID (i),
  [偏移 (i)],
  [长度 (i)],
  流数据 (..),
}
```

{{% /block_ref %}}

**流帧**包含如下字段：

流ID：

:   一个可变长度整型值，表示流的流ID，详见[第2.1章](#2.1_Stream_Types_and_Identifiers)。

偏移（Offset）：

:   一个可变长度整型值，表示**流帧**中的流数据在整条流中的字节偏移量。
    这个字段在`OFF`位置为1时存在。
    当偏移字段不存在时，偏移量为0。

长度：

:   一个可变长度整型值，表示**流帧**中的流数据字段的长度。
    该字段在`LEN`位置为1时存在。
    当`LEN`位置为0，则流数据字段会囊括数据包的所有剩余字节。

流数据（Stream Data）：

:   指定流中需要传递的字节。

当流数据字段长度为0，流帧的偏移量就是下一个将要发送的字节的偏移量。

流的首字节的偏移量是0。
流传输的最大偏移量——帧的偏移值与数据长度之和——不能超过<code>2<sup>62</sup>-1</code>，因为无法为这样的数据量分配流量控制额度。
收到一个超过该限制的帧的情况{{< req_level MUST >}}视为一个`FRAME_ENCODING_ERROR`类型或`FLOW_CONTROL_ERROR`类型的连接错误。
