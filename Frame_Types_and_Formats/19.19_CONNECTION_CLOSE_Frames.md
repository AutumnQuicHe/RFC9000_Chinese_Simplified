---
title: "19.19 连接关闭帧"
anchor: "19.19_CONNECTION_CLOSE_Frames"
weight: 191900
rank: "h2"
---

终端发送**连接关闭帧**（CONNECTION_CLOSE frame，类型是`0x1c`或`0x1d`）通知对端连接正在关闭中。
`0x1c`类型的**连接关闭帧**用于QUIC层发送错误信号，或没有错误（携带`NO_ERROR`码）。
`0x1d`类型的**连接关闭帧**用于使用QUIC的应用程序发送错误信号。

如果有打开的流尚未被显式关闭，当连接关闭时它们将被隐式关闭。

**连接关闭帧**格式如[图43](#Figure_43_CONNECTION_CLOSE_Frame_Format)所示。

{{% block_ref
    indx="Figure_43_CONNECTION_CLOSE_Frame_Format"
    title="图43：连接关闭帧格式" %}}

```
连接关闭帧 {
  类型 (i) = 0x1c..0x1d,
  错误码 (i),
  [帧类型 (i)],
  原因语句长度 (i),
  原因语句 (..),
}
```

{{% /block_ref %}}

**连接关闭帧**包含如下字段：

错误码：

:   一个可变长度整型值，表示关闭该连接的原因。
    `0x1c`类型**连接关闭帧**使用[第20.1章](#20.1_Transport_Error_Codes)定义的错误码；
    `0x1d`类型**连接关闭帧**使用[第20.2章](#20.2_Application_Protocol_Error_Codes)定义的错误码。

帧类型：

:   一个可变长度整型值，编码触发该错误的帧类型。
    值为0（相当于**填充帧**）用于未知帧类型。
    应用层型**连接关闭帧**（类型`0x1d`）不包含此字段。

原因语句长度（Reason Phrase Length）：

:   一个可变长度整型值，指定原因语句的字节长度。
    由于**连接关闭帧**不能被拆分到多个数据包，因此任何对数据包大小作出的限制也会相应得限制原因语句的可用空间。

原因语句（Reason Phrase）：

:   关闭相关的附加诊断信息。
    如果发送方选择不在错误码之外给出更多细节，该字段可以是零长度。
    该字段{{< req_level SHOULD >}}是UTF-8编码字符串<sup>[RFC3629](#RFC3629)</sup>，即使该帧没有携带如语言标签之类的信息，这些信息有助于帮助创建文本之外的其他实体理解。

**连接关闭帧**（`0x1d`类型）的应用指定变量只可以通过0-RTT或1-RTT包发送，详见[第12.5章](#12.5_Frames_and_Number_Spaces)。
当应用层意图在握手阶段放弃一条连接时，终端可以通过初始包或握手包发送一个错误码为`APPLICATION_ERROR`的**连接关闭帧**（类型`0x1c`）。
